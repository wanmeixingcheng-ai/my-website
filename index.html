import React, { useState, useEffect } from 'react';
import { MapContainer, TileLayer, CircleMarker, Popup, useMap } from 'react-leaflet';
import { Globe, TrendingUp, MessageCircle, Share2, Eye, Languages, Search, MapPin, ChevronRight, Newspaper, AlertTriangle, barChart } from 'lucide-react';
import 'leaflet/dist/leaflet.css';

// --- MOCK DATA WITH MULTI-LANG TRANSLATIONS ---
const MOCK_NEWS = [
  {
    id: 1,
    region: "Middle East",
    intensity: 0.9,
    location: [31.5, 34.4],
    originalLang: "Arabic",
    content: {
      original: "ÿ™ÿµÿπŸäÿØ ÿπÿ≥ŸÉÿ±Ÿä ŸÉÿ®Ÿäÿ± ŸÅŸä ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸàÿ≥ÿ∑Ÿâ Ÿàÿ™ÿ≠ÿ±ŸÉÿßÿ™ ÿØÿ®ÿßÿ®ÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿ≠ÿØŸàÿØ",
      en: "Major military escalation in the central sector and tank movements on the border.",
      zh: "‰∏≠ÈÉ®Âú∞Âå∫ÂèëÁîüÈáçÂ§ßÂÜõ‰∫ãÂçáÁ∫ßÔºåËæπÁïåÂá∫Áé∞Âù¶ÂÖãÊ¥ªÂä®„ÄÇ",
      ru: "–ö—Ä—É–ø–Ω–∞—è –≤–æ–µ–Ω–Ω–∞—è —ç—Å–∫–∞–ª–∞—Ü–∏—è –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º —Å–µ–∫—Ç–æ—Ä–µ –∏ –¥–≤–∏–∂–µ–Ω–∏–µ —Ç–∞–Ω–∫–æ–≤ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ.",
      fr: "Escalade militaire majeure dans le secteur central et mouvements de chars √† la fronti√®re."
    },
    stats: { views: "452K", comments: 2400, shares: 1100 },
    perspectives: [
      { country: "Regional", source: "Al Jazeera", flag: "üá∂üá¶", text: "Local sources report heavy shelling..." },
      { country: "USA", source: "CNN", flag: "üá∫üá∏", text: "Pentagon monitoring tactical movements..." }
    ]
  },
  {
    id: 2,
    region: "Eastern Europe",
    intensity: 0.7,
    location: [48.3, 38.0],
    originalLang: "Russian",
    content: {
      original: "–ê–∫—Ç–∏–≤–Ω—ã–µ –±–æ–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ä–∞–π–æ–Ω–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ —É–∑–ª–∞ —Å–Ω–∞–±–∂–µ–Ω–∏—è",
      en: "Active hostilities in the area of the strategic supply hub.",
      zh: "ÊàòÁï•Ë°•ÁªôÊû¢Á∫ΩÂå∫ÂüüÂèëÁîüÊøÄÁÉàÊàòÊñó„ÄÇ",
      ru: "–ê–∫—Ç–∏–≤–Ω—ã–µ –±–æ–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ä–∞–π–æ–Ω–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ —É–∑–ª–∞ —Å–Ω–∞–±–∂–µ–Ω–∏—è.",
      fr: "Hostilit√©s actives dans la zone du hub d'approvisionnement strat√©gique."
    },
    stats: { views: "210K", comments: 1500, shares: 800 },
    perspectives: [
      { country: "Russia", source: "TASS", flag: "üá∑üá∫", text: "Frontline units consolidated their positions..." },
      { country: "Ukraine", source: "Ukrinform", flag: "üá∫üá¶", text: "Defensive lines holding despite intense pressure..." }
    ]
  }
];

const TARGET_LANGUAGES = [
  { code: 'original', name: 'Original Language' },
  { code: 'en', name: 'English (US)' },
  { code: 'zh', name: 'Chinese (ÁÆÄ‰Ωì‰∏≠Êñá)' },
  { code: 'ru', name: 'Russian (–†—É—Å—Å–∫–∏–π)' },
  { code: 'fr', name: 'French (Fran√ßais)' }
];

function MapHandler({ center }) {
  const map = useMap();
  useEffect(() => { map.setView(center, 5); }, [center]);
  return null;
}

export default function WarNewsPlatform() {
  const [selectedNews, setSelectedNews] = useState(MOCK_NEWS[0]);
  const [targetLang, setTargetLang] = useState('original');
  const [activePerspective, setActivePerspective] = useState(0);

  return (
    <div className="flex flex-col h-screen bg-[#020202] text-slate-100 font-mono">
      
      {/* 1. TOP TICKER (Real-time Market Data) */}
      <div className="bg-black border-b border-red-900/40 py-1 overflow-hidden">
        <div className="flex space-x-12 animate-marquee whitespace-nowrap text-[10px] uppercase font-bold text-slate-400 px-4">
          <span className="text-red-600">‚óè LIVE ALERT: TENSIONS INCREASE IN RED SEA</span>
          <span>BRENT: $79.42 <span className="text-red-500">‚ñº 1.2%</span></span>
          <span>GOLD: $2056.10 <span className="text-green-500">‚ñ≤ 0.8%</span></span>
          <span>BTC/USD: $98,450 <span className="text-green-500">‚ñ≤ 2.5%</span></span>
          <span>USD/CNY: 7.23 <span className="text-red-500">‚ñº 0.1%</span></span>
        </div>
      </div>

      {/* 2. HEADER */}
      <header className="flex items-center justify-between px-6 py-4 bg-[#080808] border-b border-slate-800">
        <div className="flex items-center gap-3">
          <div className="bg-red-700 p-2 rounded shadow-lg shadow-red-900/20">
            <AlertTriangle className="text-white" size={24} />
          </div>
          <div>
            <h1 className="text-2xl font-black tracking-tighter uppercase leading-none">Global <span className="text-red-600">Conflict</span> Monitor</h1>
            <p className="text-[10px] text-slate-500 tracking-[0.3em] mt-1 font-sans font-bold">MULTI-SOURCE INTELLIGENCE ENGINE</p>
          </div>
        </div>
        
        <div className="flex items-center gap-4">
          <div className="relative hidden lg:block">
            <Search className="absolute left-3 top-2.5 text-slate-500" size={16} />
            <input className="bg-slate-900 border border-slate-800 rounded py-2 pl-10 pr-4 text-xs w-96 focus:ring-1 focus:ring-red-600 outline-none uppercase" placeholder="Search coordinates, units, or news..." />
          </div>
          <div className="flex items-center gap-2 bg-slate-900 border border-slate-800 px-3 py-1.5 rounded">
            <Languages size={16} className="text-red-600"/>
            <select 
              className="bg-transparent text-xs font-bold outline-none cursor-pointer"
              value={targetLang}
              onChange={(e) => setTargetLang(e.target.value)}
            >
              {TARGET_LANGUAGES.map(l => <option key={l.code} value={l.code} className="bg-slate-900">{l.name}</option>)}
            </select>
          </div>
        </div>
      </header>

      {/* 3. MAIN CONTENT */}
      <main className="flex flex-1 overflow-hidden">
        
        {/* LEFT LIST: ORIGINAL NEWS TITLES */}
        <div className="w-[420px] border-r border-slate-800 flex flex-col bg-[#050505]">
          <div className="p-4 bg-slate-900/50 border-b border-slate-800 flex justify-between items-center">
            <h3 className="text-[11px] font-black tracking-widest text-slate-400">LATEST INTEL</h3>
            <span className="text-[10px] bg-red-900/30 text-red-500 px-2 py-0.5 border border-red-900 rounded tracking-tighter">DATA SYNC ACTIVE</span>
          </div>
          <div className="flex-1 overflow-y-auto overflow-x-hidden scrollbar-thin scrollbar-thumb-red-900">
            {MOCK_NEWS.map(item => (
              <div 
                key={item.id}
                onClick={() => setSelectedNews(item)}
                className={`p-5 border-b border-slate-900 cursor-pointer transition-all hover:bg-red-900/5 ${selectedNews.id === item.id ? 'bg-red-900/10 border-l-4 border-l-red-600 shadow-inner' : ''}`}
              >
                <div className="flex justify-between items-center mb-2">
                  <span className="text-[10px] text-slate-500 font-bold uppercase">{item.region}</span>
                  <span className="text-[9px] text-slate-600 uppercase">2m ago</span>
                </div>
                <h4 className="text-sm font-bold mb-3 leading-snug">
                  {/* News list always shows original to maintain source integrity */}
                  {item.content.original}
                </h4>
                <div className="flex gap-4 text-[10px] font-bold text-slate-500 uppercase">
                  <span className="flex items-center gap-1"><Eye size={12} className="text-red-700"/> {item.stats.views}</span>
                  <span className="flex items-center gap-1"><MessageCircle size={12} className="text-red-700"/> {item.stats.comments}</span>
                  <span className="flex items-center gap-1"><Share2 size={12} className="text-red-700"/> {item.stats.shares}</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* RIGHT: TACTICAL MAP & MULTI-LANG DETAILS */}
        <div className="flex-1 flex flex-col relative">
          
          {/* MAP SECTION (HEATMAP) */}
          <div className="h-[45%] bg-[#080808] border-b border-slate-800 relative">
            <MapContainer center={selectedNews.location} zoom={4} zoomControl={false} className="h-full w-full grayscale contrast-125 invert-[0.05]">
              <TileLayer url="https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png" />
              <MapHandler center={selectedNews.location} />
              
              {MOCK_NEWS.map(n => (
                <React.Fragment key={n.id}>
                  {/* Heatmap Ring */}
                  <CircleMarker 
                    center={n.location} 
                    radius={40 * n.intensity} 
                    pathOptions={{ color: 'red', fillColor: 'red', fillOpacity: 0.1, weight: 0 }} 
                  />
                  {/* Core Indicator */}
                  <CircleMarker 
                    center={n.location} 
                    radius={6} 
                    pathOptions={{ color: 'white', fillColor: '#ff0000', fillOpacity: 1, weight: 2 }} 
                  />
                </React.Fragment>
              ))}
            </MapContainer>
            
            <div className="absolute bottom-4 left-4 z-[1000] bg-black/90 border border-red-900/50 p-3 flex flex-col gap-2">
              <div className="text-[10px] font-bold text-red-500 uppercase tracking-widest border-b border-red-900/30 pb-1 mb-1">Conflict Heatmap Legend</div>
              <div className="flex items-center gap-3">
                <div className="flex -space-x-1">
                  <div className="w-3 h-3 bg-red-900 rounded-full"></div>
                  <div className="w-3 h-3 bg-red-600 rounded-full animate-pulse"></div>
                  <div className="w-3 h-3 bg-red-400 rounded-full"></div>
                </div>
                <span className="text-[10px] text-slate-400 uppercase">Kinetic Intensity Scale</span>
              </div>
            </div>
          </div>

          {/* CONTENT SECTION (DETAILS & PERSPECTIVES) */}
          <div className="flex-1 overflow-y-auto bg-[#030303] p-8 scrollbar-thin scrollbar-thumb-slate-800">
            <div className="max-w-6xl mx-auto">
              
              {/* Dynamic Translated Title */}
              <div className="flex justify-between items-start mb-8 gap-8">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="text-[10px] bg-red-600 px-1 font-black text-white uppercase tracking-tighter">Urgent</span>
                    <span className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]">{selectedNews.region} // Sector {selectedNews.id}-A</span>
                  </div>
                  <h2 className="text-4xl font-black uppercase tracking-tighter leading-none mb-4 text-white">
                    {targetLang === 'original' ? selectedNews.content.original : selectedNews.content[targetLang]}
                  </h2>
                </div>
                
                <div className="bg-slate-900/50 border border-slate-800 p-4 min-w-[240px]">
                   <div className="text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-widest">Global Heat Index</div>
                   <div className="h-2 bg-slate-800 rounded-full overflow-hidden mb-2">
                      <div className="h-full bg-red-600" style={{ width: `${selectedNews.intensity * 100}%` }}></div>
                   </div>
                   <div className="text-[10px] text-red-500 font-bold">INTENSITY: EXTREME ({selectedNews.intensity * 10})</div>
                </div>
              </div>

              {/* PERSPECTIVES DECODER */}
              <div className="grid grid-cols-12 gap-8 mb-12">
                <div className="col-span-8">
                  <div className="flex gap-1 mb-4 border-b border-slate-800">
                    {selectedNews.perspectives.map((p, idx) => (
                      <button 
                        key={idx}
                        onClick={() => setActivePerspective(idx)}
                        className={`px-6 py-2 text-[11px] font-black uppercase transition-all ${activePerspective === idx ? 'bg-red-700 text-white shadow-[0_-2px_10px_rgba(185,28,28,0.3)]' : 'text-slate-600 hover:text-slate-400'}`}
                      >
                        {p.flag} {p.country}
                      </button>
                    ))}
                  </div>
                  
                  <div className="bg-slate-900/30 border border-slate-800 p-6 relative">
                    <div className="absolute -top-3 left-6 bg-red-700 px-2 py-0.5 text-[9px] font-bold">INTEL SOURCE: {selectedNews.perspectives[activePerspective].source.toUpperCase()}</div>
                    <p className="text-2xl font-serif italic text-slate-200 leading-relaxed mb-6">
                       "{selectedNews.perspectives[activePerspective].text}"
                    </p>
                    <button className="text-[10px] font-bold text-red-500 hover:text-red-400 flex items-center gap-2 uppercase tracking-widest">
                      Verify Original Source <ChevronRight size={14}/>
                    </button>
                  </div>
                </div>

                <div className="col-span-4">
                  <div className="bg-slate-900/50 border border-slate-800 p-5 h-full">
                    <h4 className="text-[10px] font-black text-red-600 uppercase mb-4 tracking-[0.2em] flex items-center gap-2">
                      <Newspaper size={14}/> AI Briefing ({TARGET_LANGUAGES.find(l => l.code === targetLang)?.name})
                    </h4>
                    <p className="text-xs text-slate-400 leading-relaxed mb-6">
                      {/* In a real app, this summary would also be translated via AI */}
                      Analysis of multiple data points indicates a tactical shift. Visual confirmation of unit movement matches satellite reconnaissance.
                    </p>
                    <div className="space-y-3">
                      <div className="flex justify-between text-[10px] border-b border-slate-800 pb-2 uppercase font-bold text-slate-500">
                        <span>Total Intel Views</span>
                        <span className="text-white">{selectedNews.stats.views}</span>
                      </div>
                      <div className="flex justify-between text-[10px] border-b border-slate-800 pb-2 uppercase font-bold text-slate-500">
                        <span>Active Discussions</span>
                        <span className="text-white">{selectedNews.stats.comments}</span>
                      </div>
                      <div className="flex justify-between text-[10px] border-b border-slate-800 pb-2 uppercase font-bold text-slate-500">
                        <span>Global Shares</span>
                        <span className="text-white">{selectedNews.stats.shares}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* COMMENTS SECTION PREVIEW */}
              <div className="border-t border-slate-900 pt-8">
                <h3 className="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-2">
                  <MessageCircle size={16} className="text-red-600"/> Intel Discussion Area
                </h3>
                <div className="flex gap-4 items-start mb-6 opacity-60">
                  <div className="w-8 h-8 bg-slate-800 rounded flex-shrink-0 border border-slate-700"></div>
                  <div className="flex-1 bg-slate-900/50 p-4 border border-slate-800">
                    <p className="text-xs text-slate-400 font-sans italic italic">Add your operational analysis or feedback here...</p>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </main>

      {/* CUSTOM CSS FOR MARQUEE AND MAP */}
      <style>{`
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: flex; animation: marquee 30s linear infinite; }
        .scrollbar-thin::-webkit-scrollbar { width: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #450a0a; }
        .leaflet-container { background: #020202 !important; }
        .leaflet-popup-content-wrapper { background: #000; color: #fff; border-radius: 0; border: 1px solid #450a0a; }
      `}</style>
    </div>
  );
}
